# 网络基本知识
**分时系统**：多路性、独占性、交互性、及时性

==TCP/IP是通信协议的统称==

分组交换协议：将大数据分割为一个个叫做包的较小单位进行传输
分层：上下层间交互遵循的约定称为“接口”；同层间的交互遵循的约定称为“协议”
*	OSI参考模型（7层）
	==应用层==：通信相关
    ==表示层==：编码格式，数据的具体表现形式
    ==会话层==：采用何种连接发送
    ==传输层==（交换机）：保证数据传输的可靠性
    ==网络层==（路由器）：在网络与网络相互连接的环境中，将数据从发送端主机发送到接收端主机
    ==数据链路层==（网桥）：向物理地址发送信号，在互联同一种数据链路的节点之间进行包传递

    *	介质访问控制层（MAC）
    *	逻辑链路控制层（LLC）

    ==物理层==（中继器/再生信号放大器）：同上以及将电信号转化为二进制的0，1序列
    **ps：网关与4-7层交换机都是处理传输层及以上的数据，但是网关不仅转发数据还对数据进行转换**
*	OSI协议
	以OSI参考模型为基础界定了各阶层标准。两者是两个概念

###传输方式分类
*	网络发送方式
面向连接（类比打电话）
无连接（类比送信）

*	网络通信方式
电路交换（串行）
分组交换（并行，通过共享通信线路）

*	接收端数量
单播
多播（多个）
广播（所有）
任播（任意）

MAC和IP地址都具有唯一性，但只有IP地址具有层次性
****
# TCP/IP基础知识
**TCP/IP具体含义**：利用IP进行通信时所必须用到协议的统称（IP,ICMP,TCP,UDP,TELNET,FTP,HTTP……）
包括应用协议，传输协议，网际协议，路由控制协议

### TCP/IP协议分层模型
*	==硬件（物理层）==
*	==网络接口层（数据链路层）==
*	==互联网层（网络层）==
	*	IP协议，使用IP地址作为主机标识，不具有重发机制
	*	ICMP协议：错误侦测与回报
	*	ARP协议：解析IP为MAC地址
*	==传输层==
	*	TCP面向连接
	*	UDP无连接
*	==应用层==
	*	WWW（HTTP，HTML），Email，FTP,TELNET,SSH

在下层的角度看，从上一层收到的包全部被认为是本层的数据

![IMG_20180705_164511.jpg](.\TCP-IP\IMG_20180705_164511.jpg)

每个包首部至少包含：发送端和接收端地址以及上一层的协议类型

![IMG_20180705_163036.jpg](.\TCP-IP\IMG_20180705_163036.jpg)

****
# 数据链路
*网络拓扑结构：总线型，星型，环型，网状型*
MAC地址的3\~24位是厂商识别码，25~48位是厂商内识别码
>从通信介质的使用方法上分类，网络分为

*	共享介质型网络
	介质访问控制方式
    *	争用方式（CSMA）
    *	令牌传递方式
*	非共享介质型网络
	*	使用交换机实现全双工通信

交换机转发方式：存储转发，直通转发
网桥将数据帧拷贝给相连的链路，会导致循环转发的出现。可以使用生成树法（发生故障时自动切换网络，绕行，但是效率低）或源路由法（发送端本身需具备源路由的功能）解决
### 无限通信
无线PAN（802.15），无线WAN（802.16），无线LAN（802.11），无线MAN（802.16），无线RAN（802.22）
蓝牙，WiMax，ZigBee
### 数据链路类型
以太网，无线通信，PPP，ATM，POS，FDDI，Token Ring，100VG-AnyLAN，光纤通信，HIPPI，IEEE1394，HDMI,iSCSI,InfiniBand DOCSIS,高速PLC
### 公共网络
模拟电话线路（猫），移动通信服务（流量），ADSL（对猫的扩展），FTTH（光纤），有线电视，专线，VPN（虚拟专用网络：通过在IP协议包中附加标签进行传输控制），公共无线LAN
****

# IP协议
*IP（IPv4，IPv6）协议位于网络层*

==IP的主要作用==
在复杂的网络环境中将数据包发给最终的目标地址
数据链路层和网络层的主要区别在于前者是后者的具体实现方式，后者是前者的总体规划以及实现细节

==IP大致分为三大寻址模块==

*	IP寻址
*	路由
*	IP分包与组包

*数据链路实现某一区间（一跳）内的通信，IP实现直至最终目标地址的通信（点对点）*

*IP为无连接型* 为了简化与提速
IP负责将数据发送给目标主机，TCP负责保证对端主机确实接收到数据（协议分层）
IP地址在计算机内以二进制的形式被处理，因为习惯问题，所以，人们将32位的IP地址每8位为一组，分成4组，以“.”隔开

==IP地址由网络标识和主机标识两部分组成==
如IP地址：192.168.128.19 其中，192.168.128是网络标识，19是主机标识

IP地址分为**A类（首位0，前8位为网络标识，后24位为主机标识）B类（首位10，前16位为网络标识，后16位为主机标识）C类（首位110）D类（同A类和B类依此类推）==D类前四位为“1110”，没有主机地址，常被用于多播==**

==子网掩码==
用二进制方式表示的话，也是一个32位的数字。对应IP地址网络标识部分的位全部为“1”，对应主机标识部分的全部为“0”

有了CIDR和VISM技术，相对缓解了全局IP地址不够用的问题
在IPv6未普及的情况下，现在的方法是通过少数设置全局IP地址的代理服务器结合NAT的设置进行互联网通信
将IP地址中的主机地址全部设置为1，就形成了广播地址

*	本地广播（同一网络中）
*	直接广播（不同网络之间）
****

### IP地址与路由控制
路由控制表中记录着网络地址与下一步应该发送至路由器的地址

==默认路由==
默认路由是指路由表中任何一个地址都能与之匹配的记录
==主机路由==
整个IP地址中的所有位都将参与路由
==环回地址==
在同一台计算机的程序之间进行网络通信时的一个默认地址

**MTU：最大传输单元**
==路径MTU发现==
从发送主机按照路径MTU的大小将数据报分片后进行发送，这样就可以避免在路由器上进行分片处理，提高效率

### IPv6
IPv4的地址是4个8位字节，即32比特
IPv6的地址是8个16位字节，即128比特

==全局单播地址==
是互联网通信以及各个与内部通信中最为常用的一个IPv6地址。前64比特位网络标识，后64比特位主机标识

*通过IP进行通信时，需在数据前面加入IP首部信息*

IPv4首部     |IPv6首部
------------|--------
*	版本（4比特）：IP版本号4|同IPv4，版本号为6
*	首部长度（4比特）：IP首部大小|
*	区分服务（8比特）：表明服务质量|通信量类（8比特）
*	DSCP段誉ECN段|流标号（20比特）:服务质量控制
*	总长度（16比特）：所以IP包的最大长度为~2~16，即65536字节|有效荷载长度：包的数据部分
*	标识（16比特）：用于分片重组|
*	标志（3比特）：表示分片相关信息|
*	片偏移（13比特）|
*	生存时间（8比特）|
*	协议（8比特）：IP包传输层上层协议编号|下一个首部（8比特）:后面第一个扩展首部的协议类型
*	首部校验和（16比特）|跳数限制（8比特）：可通过路由器个数
*	源地址（32比特）：发送端IP地址|源地址（128比特）
*	目标地址:见上一条|目标地址（128比特）
*	可选项|
*	填充|
*	数据|

IPv6首部长度固定，可通过扩展首部（无长度限制）对功能进行扩展，介于IPv6与TCP/UDP首部中间
****

# IP协议相关技术
### DNS
通过域名查找IP地址，或者反向通过IP地址查找域名的服务
DNS解析器（工作站，个人电脑等）和DNS域名服务器
DNS：管理主机名与IP地址之间对应关系的数据库，通过维护一个用来表示组织内部主机名和IP地址之间对应关系的数据库来实现

### ARP
解决地址问题：以IP地址为线索，定位下一个网络设备对应的MAC地址
ARP缓存MAC与IP地址映射表，以减少请求响应过程

==RARP==
与ARP相反，获取IP地址返回MAC地址

### ICMP
确认IP包是否成功送达目标地址，通知在发送过程当中IP包被废弃的具体原因。改善网络设置等

*	通知出错原因的错误消息
*	用于诊断的查询消息

==ICMP消息类型==

类型（十进制数）|内容
-------------|---
0|回送应答（进行通信的主机与路由器之间，判断所发送的数据包是否成功到达）
3|目标不可达
4|原点抑制（为了缓和路由器遇到网络拥堵的问题）
5|重定向或改变路由（路由器发现发送端主机使用了次优的路径发送数据）
8|回送请求
9|路由器公告
10|路由器请求（用于发现与自己项链网络中的路由器）
11|超时
17|地址子网请求（主机或路由器想了解子网掩码的情况）
18|地址子网应答

### ICMPv6
IPv6上的ICMP协议，不同于IPv4的IP协议的辅助，ICMPv6是通信必不可少的

*	错误消息（类型0-127）
*	信息消息（类型128-255）

### DHCP
自动设置IP地址，统一管理IP地址分配
一般家庭网路，是由路由器充当DHCP服务器的角色。但是大的局域网中，可以使用DHCP中继代理来管理每个网段，这样只需要一个DHCP服务器即可

### NAT
在本地网络中使用私有地址，转入互联网时使用使用全局IP地址的技术
*在使用TCP或者UDP通信中，只有目标地址、源地址、目标端口、源端口、以及协议类型（TCP或者UDP）五项一致时才被认为是同一个通信连接*

==NAT潜在问题==
由于NAT依赖自己的转换表

*	无法从NAT的外部向内部服务器奖励连接
*	转换表的生成与转换操作都会产生一定的开销
*	通信过程中一旦NAT遇到异常需要重启，所有的TCP连接都会被重置
*	即使备置两台NAT做容灾备份，TCP连接还是会被断开

### IP隧道
在网络层的首部后面继续追加网络层首部

MAC地址|IP地址
---|---
数据链路中|IP中
识别同一链路中的不同计算机|识别TCP/IP网络中互联的主机和计算机
****

# TCP与UDP

通过收到数据的目标端口号识别发给的是哪个服务端
TCP|UDP
------|---
可靠的、面向连接的流协议、速度慢|面向无连接的数据报协议，速度快
传输大量数据|传输少量数据
可以进行丢包时的重发控制|将应用程序（用户）发来的数据收到的那一刻，立即按照原样发送到网络上
TCP通信开始后，网路吞吐量会逐渐上升，随着网络拥堵的发生优惠急速下降，然后再次缓慢上升（看上去好像是在逐步占据网络带宽）|
TCP文件传输中，绝大多数是每两个数据段返回一个确认|

TCP首部格式|UDP首部格式（都为16bit）
------|-------
源端口号（16bit）|源端口号
目的端口号（16bit）|目标端口号
序列号（32bit）|包长度(保存UDP首部长度和数据长度之和)
确认应答号（32bit）|校验和（提供可靠的UDP首部和数据）
数据偏移（4bit）|
……|
*连接也叫虚拟电路*

++采用五个信息来识别一个通信++
源IP地址、目标IP地址、协议号、源端口号、目标端口号

==确定端口号的方法==

*	静态方法：每个应用程序尤其指定的端口号
*	动态（时序）方法：操作系统为应用程序分配端口号（49152-65535）

==捎带应答==

是指在同一个TCP包中即发送数据又发送确认应答的一种机制

****
# 路由协议
IGP：内部网关协议：区域网络内部进行主机识别
EGP：外部网关协议：区域网络之间进行网络识别

### 路由算法
*	距离向量算法（只有距离和方向的信息）
*	链路状态算法（所用路由器持有相同的信息，整个网络的路由信息表）

### 主要路由协议
*	RIP
	*	主要思想
		*	将自己所知道的路由信息定期广播
		*	一旦认为网络断开，数据将无法流过此路由器，其他路由器可以得知网络已经断开
	*	无限计数问题的解决
		*	设置最长距离16
		*	水平分割 （接收到的信息不再返还给发送端）
	*	环路问题的解决
		*	触发更新（依次更新路由表）
		*	毒性逆转（水平分割的一种变型。使用这种方法时，路由器收到的信息用来更新路由表，然后通过所有的接口发送出去。但是，已经从一个接口来的一个路由表项目在通过同样的接口发送出去时，就要将其度量置为16）
*	RIP2（多播，支持子网掩码，路由选择域，外部路由标志，身份验证密钥）
*	OSFP（链路状态型路由协议）
			链路状态型路由协议：路由器之间交换链路状态生成网络拓扑信息，据此生成路由信息表
	*	工作原理（HELLO协议）
		*	网络上的设备在接收到hello请求后返回hello应答。网络设备按照指定的时间间隔发送hello数据包，以表明自己仍处于工作状态。通过检查hello数据包，网络设备可以学习到其他设备的逻辑地址（ip）或物理地址（mac）
	*	潜在问题
		*	随着网络规模的增大，拓扑数据库也会越来越大，路由器控制信息的计算也就越来越困难（由此引入区域的概念）

RIP|OSPF|BGP
---|---|---
选择路由器个数最少的路径|选择总代价最小的路径|选择AS（自治系统）最小的路径
只有一种类型的包：浪费网络带宽|五种类型的包：减少网络流量
|为了减小计算符合，引入了区域的概念|能够检测出环路，避免了无限计数的问题
||转发速度快，不用维护路由表
||利用标记生成虚拟路径

*	MPLS（多协议标记交换技术）
	*	标记交换：对每个IP包设定一个叫做“标记”的值，然后根据这个“标记”再进行转发
	*	通常无法在路由器上进行，需要特殊的标记交换路由器（LSR）

**路由协议（使网络中所有路由器保持正确的路由信息）是一个巨大的，跨越整个互联网的分布式系统**
****

# 应用协议
**不同于TCP和IP等下层协议（不依赖于上层协议，适用性非常广），应用协议是为了实现某种应用而设计和创造的协议**
### 远程登陆
TELNET|SSH
---|--
利用与TCP的一条连接，向主机发送文字命令并在主机上执行（shell）|加密的远程登陆系统
仿真终端（登陆服务器）|端口转发（特定端口号收到的信息转发到特定IP地址和端口号码）
协商选项（逐行或者逐字输入指令）|转发文件
|认证

### 文件传输
**FTP实在两个相连的计算机之间传输文件的协议**

FTP服务命令|
---|---
|
###电子邮件的机制

*	邮件地址
*	数据格式（MIME）
*	发送协议（SMTP）
	*	当允许使用TELNET登陆服务器时，可登陆SMTP服务器后输入命令
	~~~d
    telnet 服务器名或其IP地址 25
    ~~~
    *	SMTP的一个不利之处在于它支持的是发送端主机的的行为，而不是接收端主机
*	POP

	*	为了解决SMTP存在的问题，引入了POP协议（用于接收电子邮件的协议）
方式：
发送端通过SMTP协议与POP服务器建立连接，将插电状态的发送端邮件发送到POP服务器，接收端再通过POP协议与POP服务器建立连接，接受POP服务器发来的邮件（为防止邮件盗窃，还要进行用户验证）

*	IMAP(类似于POP也是接受电子邮件的协议)
	*	不同点在于IMAP是在服务器端进行邮件的管理
	*	为异构终端的环境提供了极大的便利

### WWW基本概念
*	URI（访问信息的手段与位置）
	*	是相比于URL更加广泛的定义
*	信息表现形式（HTML）
*	转发手段（HTTP）

JavaScript是一种嵌入在HTML中的语言，作为客户端程序可以运行多种浏览器中

### 网络管理
*	SNMP（简单网络管理协议）
	*	一款基于TCP/IP的协议，是一款在IP网络中管理网络节点（如服务器，工作站，路由器，交换机等）的标准协议
	*	基本结构
		*	由一组网络的标准构成，包含一个应用层协议，数据库模型和一组资源对象。该协议能够支持网络管理系统，用以检测连接到网络上的设备是否有任何引起管理上关注的情况
	*	工作原理
		*	在典型的SNMP用法中，有许多系统被管理，而且是有一或者多个系统在管理它们

### 其他应用层协议
*	H.323
*	SIP
*	RTP
*	P2P
	*	网络上的主机或者终端直接1对1相互通信的情况叫做P2P
	**也有不支持P2P的情形，比如服务器需要在能够连接到互联网的环境中，而NAT（解决了IP地址不足的问题，能够有效避免来自外部网络的攻击，隐藏并保护网络内部的计算机——通过将本地IP地址转换为全球IP地址）内部的终端此时就不能互相进行P2P通信**
*	LDAP（访问目录服务的一种协议）
****

# 网络安全

### TCP/IP与网络安全
==防火墙基本设计思路==
暴漏给危险的主机和路由器个数要有限

==IDS==（入侵检测系统）
依照一定的安全策略，通过软硬件对网络系统运行状况进行监视，尽可能发现各种攻击企图、攻击行为或者攻击结果，保证网络系统资源的安全。一个比喻：加入防火墙是一栋大楼的门锁，IDS就是楼内的监控系统，如果有人爬窗子进入大楼，就可以发出警告

**DMZ：将外网与内网隔开的专用子网**

### 加密技术基础
分层|加密技术|简介
---|---|---
应用层|SSH,SSL-Telnet，PET等远程登陆，PGP，S/MIME等加密邮件|SSH（安全外壳协议）：可以通过对数据加密避免“中间人”攻击（“中间人”冒充服务器接收传给服务器的数据，然后经过篡改后传给真正的服务器）
表示层，传输层|SSL/TLS，SOCKS V5加密|SSl：1、认证用户和服务器，确保数据发送到正确的服务器和客户机之上 2、加密数据 3、维护数据完整性
网络层|IPsec|（在IP首部后面追加“封装安全有效载荷”和“认证首部”）IP安全协议集，功能包括数据加密、对网络单元的范文控制、数据源地址验证，完整性检查、防止重放攻击
数据链路层|Ethernet，WAN加密装置，PPTP（PPP）|PPTP（点对点隧道协议）：通过该协议，远程用户能通过windows操作系统以及其他装有点对点协议的系统安全访问公司网络，并能拨号连入本地ISP（互联网服务提供商）

### 身份认证技术
*	根据所知道的信息进行认证（密码或私有代码）
*	根据所拥有的信息进行认证（ID卡，电子证书）
*	根据独一无二的体态特征进行认证（指纹，视网膜等）

**VPN（虚拟专用网）**

### 安全协议
HTTPS：使用TLS/SSL的HTTP通信叫做HTTPS通信，采用对称加密方式
***
## 物理层相关基础知识
通信线路在传输上可以分为两种方式

*	模拟方式 传感器采集的连续的值
*	数字方式 将传感器采集的值进行离散化

UDP首部格式
TCP首部格式
IPv4首部格式
IPv6首部格式
IP地址结果
IPv6地址结构